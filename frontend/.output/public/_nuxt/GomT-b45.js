import{_ as ee,r as n,a0 as te,aQ as ae,c as d,a,A as C,b as w,k as m,F as N,j as F,m as I,n as $,t as R,d as E,aM as oe,o as i}from"./BOPGzfFW.js";import{M as H}from"./C3mhGiyy.js";import{P as le,a as re,S as ne,U as L,R as ie}from"./BeveYWbR.js";const se={class:"min-h-screen py-12 px-4 bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-950"},de={class:"container mx-auto max-w-4xl"},ue={class:"relative bg-white dark:bg-gray-800 p-8 rounded-xl border border-gray-200 dark:border-gray-700 shadow-xl"},ce={class:"h-64 bg-gray-100 dark:bg-gray-700 rounded-lg mb-6 flex items-center justify-center overflow-hidden"},ve={key:0,class:"text-gray-500 dark:text-gray-400 flex flex-col items-center"},ge={key:1,class:"w-full h-full flex items-center justify-center p-4"},fe={class:"flex items-end gap-1 w-full h-full"},he={class:"flex flex-col gap-6"},ye={key:0,class:"flex items-center justify-center gap-4"},me=["disabled"],xe={class:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},pe={class:"text-sm text-gray-600 dark:text-gray-400"},be={class:"flex flex-wrap gap-4 justify-center"},we={class:"text-xl font-bold mb-4 flex items-center gap-2 text-gray-900 dark:text-white"},ke={class:"space-y-4"},_e={class:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-md shadow-sm"},Se={class:"flex items-center gap-3"},Ae={class:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center"},Ce={class:"font-medium text-gray-900 dark:text-white"},Re={class:"text-lg font-bold text-indigo-600 dark:text-indigo-400"},Me={class:"flex items-center gap-3"},Ee={class:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center"},Be={class:"font-medium text-gray-900 dark:text-white"},Le={class:"text-lg font-medium text-gray-600 dark:text-gray-400"},ze={__name:"record2",setup(Pe){const p=n(!1),g=n(null),z=n([]),y=n(null),P=n(""),l=n(null),f=n(null),r=n(null),s=n(null),V=n(Array(50).fill(5)),j=n("opacity-0 translate-y-4"),h=n(!1),B=n(0),_=n(0),J=te(()=>_.value===0?0:B.value/_.value*100),S=n(null),k=n([]),G=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});g.value=new MediaRecorder(e),z.value=[],r.value=new(window.AudioContext||window.webkitAudioContext);const t=r.value.createMediaStreamSource(e);s.value=r.value.createAnalyser(),s.value.fftSize=64,t.connect(s.value),g.value.ondataavailable=o=>{z.value.push(o.data)},g.value.onstop=()=>{const o=new Blob(z.value,{type:"audio/wav"});y.value=o,P.value=URL.createObjectURL(o),l.value=new Audio(P.value),l.value.addEventListener("timeupdate",D),l.value.addEventListener("loadedmetadata",()=>{_.value=l.value.duration,console.log("Audio metadata loaded, duration:",_.value),K()}),l.value.addEventListener("ended",()=>{h.value=!1}),X()},g.value.start(),p.value=!0,W()}catch(e){console.error("Error starting recording:",e)}},W=()=>{if(!p.value||!s.value)return;const e=new Uint8Array(s.value.frequencyBinCount);s.value.getByteFrequencyData(e);const t=[];for(let o=0;o<50;o++){const u=Math.floor(o/50*e.length);t.push(Math.max(5,Math.min(100,e[u]/2)))}V.value=t,requestAnimationFrame(W)},O=()=>{g.value&&p.value&&(g.value.stop(),p.value=!1,g.value.stream.getTracks().forEach(e=>e.stop()),r.value&&(r.value.close(),r.value=null,s.value=null))},Q=()=>{l.value&&(l.value.pause(),l.value.removeEventListener("timeupdate",D)),y.value=null,P.value="",l.value=null,h.value=!1,B.value=0,_.value=0,S.value=null,j.value="opacity-0 translate-y-4",k.value=[],f.value&&f.value.getContext("2d").clearRect(0,0,f.value.width,f.value.height)},Y=()=>{if(!l.value){console.error("No audio element available");return}h.value?(l.value.pause(),console.log("Pausing audio")):l.value.play().then(()=>{console.log("Playing audio")}).catch(e=>{console.error("Error playing audio:",e)}),h.value=!h.value},D=()=>{l.value&&(B.value=l.value.currentTime)},q=e=>{if(isNaN(e))return"00:00";const t=Math.floor(e/60),o=Math.floor(e%60);return`${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},K=async()=>{if(!(!y.value||!f.value))try{const e=await y.value.arrayBuffer();r.value=new(window.AudioContext||window.webkitAudioContext);const o=(await r.value.decodeAudioData(e)).getChannelData(0),u=Math.floor(f.value.offsetWidth),v=Math.floor(o.length/u),c=[];for(let x=0;x<u;x++){let M=x*v,A=0;for(let U=0;U<v;U++)A+=Math.abs(o[M+U]||0);c.push(A/v)}const b=Math.max(...c);b>0?k.value=c.map(x=>x/b*.8):k.value=c,T()}catch(e){console.error("Error processing waveform:",e)}},T=()=>{if(!f.value||!k.value.length)return;const e=f.value,t=e.getContext("2d");e.width=e.offsetWidth,e.height=e.offsetHeight,t.fillStyle="#e5e7eb",t.fillRect(0,0,e.width,e.height),t.beginPath(),t.strokeStyle="#4f46e5",t.lineWidth=2;const o=e.height/2;e.height/2;const u=e.width/k.value.length;for(let v=0;v<k.value.length;v++){const c=v*u,b=o-k.value[v]*o;v===0?t.moveTo(c,b):t.lineTo(c,b)}t.stroke()},X=()=>{if(!f.value||!y.value||!l.value){console.error("Visualizer setup failed: Missing canvas, audioBlob, or audioElement");return}const e=f.value,t=e.getContext("2d");if(e.width=e.offsetWidth,e.height=e.offsetHeight,e.width===0||e.height===0){console.error("Canvas has invalid dimensions:",e.width,e.height);return}T(),r.value=new(window.AudioContext||window.webkitAudioContext),r.value.state==="suspended"&&r.value.resume().then(()=>{console.log("AudioContext resumed")}),s.value=r.value.createAnalyser(),s.value.fftSize=256;const o=s.value.frequencyBinCount,u=new Uint8Array(o);try{r.value.createMediaElementSource(l.value).connect(s.value),s.value.connect(r.value.destination)}catch(c){console.error("Error connecting audio source:",c);return}const v=()=>{if(!h.value||!s.value){T();return}s.value.getByteFrequencyData(u),t.fillStyle="#e5e7eb",t.fillRect(0,0,e.width,e.height);const c=e.width/o*2.5;let b=0;for(let x=0;x<o;x++){const M=u[x]/255*e.height,A=t.createLinearGradient(0,e.height,0,e.height-M);A.addColorStop(0,"#4f46e5"),A.addColorStop(1,"#6366f1"),t.fillStyle=A,t.fillRect(b,e.height-M,c,M),b+=c+1}requestAnimationFrame(v)};l.value.addEventListener("play",()=>{console.log("Audio play event triggered, starting visualization"),h.value=!0,v()}),l.value.addEventListener("pause",()=>{console.log("Audio paused"),h.value=!1}),l.value.addEventListener("ended",()=>{console.log("Audio ended"),h.value=!1})},Z=()=>{setTimeout(()=>{S.value={name:"John Smith",confidence:92,otherSpeakers:[{name:"Sarah Johnson",confidence:45},{name:"Michael Chen",confidence:23}]},j.value="opacity-100 translate-y-0"},2e3)};return ae(()=>{g.value&&g.value.state==="recording"&&(g.value.stop(),g.value.stream.getTracks().forEach(e=>e.stop())),l.value&&(l.value.pause(),l.value.removeEventListener("timeupdate",D)),r.value&&r.value.close()}),(e,t)=>(i(),d("div",se,[a("div",de,[t[8]||(t[8]=a("h1",{class:"text-3xl font-bold mb-8 text-center text-gray-900 dark:text-white"},[a("span",{class:"text-indigo-600 dark:text-indigo-400"},"Speaker Identification")],-1)),a("div",ue,[a("div",ce,[!y.value&&!p.value?(i(),d("div",ve,[w(m(H),{class:"h-12 w-12 mb-2"}),t[0]||(t[0]=a("p",null,'Click "Start Recording" to begin',-1))])):p.value?(i(),d("div",ge,[a("div",fe,[(i(!0),d(N,null,F(V.value,(o,u)=>(i(),d("div",{key:u,class:"bg-indigo-500 dark:bg-indigo-400 w-2 rounded-full transition-all duration-75 ease-in-out",style:$(`height: ${o}%`)},null,4))),128))])])):(i(),d("canvas",{key:2,ref_key:"visualizer",ref:f,class:"w-full h-full bg-gray-200 dark:bg-gray-900",style:{"min-height":"256px"}},null,512))]),a("div",he,[y.value?(i(),d("div",ye,[a("button",{onClick:Y,class:"p-3 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-full transition-all duration-300",disabled:h.value},[h.value?(i(),I(m(re),{key:1,class:"h-5 w-5 text-indigo-600 dark:text-indigo-400"})):(i(),I(m(le),{key:0,class:"h-5 w-5 text-indigo-600 dark:text-indigo-400"}))],8,me),a("div",xe,[a("div",{class:"h-full bg-indigo-600 dark:bg-indigo-500 transition-all duration-300",style:$(`width: ${J.value}%`)},null,4)]),a("div",pe,R(q(B.value))+" / "+R(q(_.value)),1)])):C("",!0),a("div",be,[!p.value&&!y.value?(i(),d("button",{key:0,onClick:G,class:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md transition-all duration-300 hover:shadow-md flex items-center gap-2"},[w(m(H),{class:"h-5 w-5"}),t[1]||(t[1]=E(" Start Recording "))])):C("",!0),p.value?(i(),d("button",{key:1,onClick:O,class:"px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-md transition-all duration-300 hover:shadow-md flex items-center gap-2"},[w(m(ne),{class:"h-5 w-5"}),t[2]||(t[2]=E(" Stop Recording "))])):C("",!0),y.value?(i(),d("button",{key:2,onClick:Z,class:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md transition-all duration-300 hover:shadow-md flex items-center gap-2"},[w(m(L),{class:"h-5 w-5"}),t[3]||(t[3]=E(" Identify Speaker "))])):C("",!0),y.value?(i(),d("button",{key:3,onClick:Q,class:"px-6 py-3 border border-gray-300 hover:border-indigo-500 text-gray-700 dark:text-gray-300 dark:border-gray-600 rounded-md transition-all duration-300 hover:shadow-md flex items-center gap-2"},[w(m(ie),{class:"h-5 w-5"}),t[4]||(t[4]=E(" Record Again "))])):C("",!0)])]),S.value?(i(),d("div",{key:0,class:oe(["mt-8 p-6 bg-gray-100 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 transition-all duration-500 ease-out",j.value])},[a("h3",we,[w(m(L),{class:"h-5 w-5 text-indigo-600 dark:text-indigo-400"}),t[5]||(t[5]=E(" Identification Results "))]),a("div",ke,[a("div",_e,[a("div",Se,[a("div",Ae,[w(m(L),{class:"h-6 w-6 text-indigo-600 dark:text-indigo-400"})]),a("div",null,[a("div",Ce,R(S.value.name),1),t[6]||(t[6]=a("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"Primary Speaker",-1))])]),a("div",Re,R(S.value.confidence)+"%",1)]),(i(!0),d(N,null,F(S.value.otherSpeakers,(o,u)=>(i(),d("div",{key:u,class:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-md shadow-sm"},[a("div",Me,[a("div",Ee,[w(m(L),{class:"h-6 w-6 text-gray-500 dark:text-gray-400"})]),a("div",null,[a("div",Be,R(o.name),1),t[7]||(t[7]=a("div",{class:"text-sm text-gray-500 dark:text-gray-400"},"Possible Match",-1))])]),a("div",Le,R(o.confidence)+"%",1)]))),128))])],2)):C("",!0)])])]))}},Ue=ee(ze,[["__scopeId","data-v-3e30bd85"]]);export{Ue as default};
